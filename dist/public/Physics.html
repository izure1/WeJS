<!DOCTYPE HTML>
<html>

<head>
</head>

<body>
  <div id="app"></div>
  <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
  <script src="../lib/WeJS.js"></script>
  <script>
    function getRandomNumber(a, b) {
      return Math.random() * (b - a) + a
    }
  </script>
  <script>
    const app = new WeJS.App // 새로운 viewport 만들기
    const scene = new WeJS.Scene3d // 새로운 씬
    const collider = new WeJS.Collider // 씬에 부착될 충돌기입니다. 이 규칙에 의거하여 강체 간 충돌을 결정지을 것입니다.

    const factory = new WeJS.ComponentFactory // 컴포넌트를 만들어주는 인스턴스 객체

    const objectA = new WeJS.View
    const objectB = new WeJS.View
    const ground = new WeJS.View


    for (let i = 0; i < 100; i++) {

      const object = new WeJS.View

      // 물리 효과를 주기 위해 물리 컴포넌트를 생성합니다
      object.id = i
      object.component.add(factory.create(WeJS.RESERVATION.RECT))
      object.component.add(factory.create(WeJS.RESERVATION.PHYSICS))

      const {
        rect,
        physics,
        filter,
        transform,
      } = object.component

      rect.color = `rgb(${getRandomNumber(0, 255)}, ${getRandomNumber(0, 255)}, ${getRandomNumber(0, 255)})`
      rect.width = 35
      rect.height = 35
      physics.isStatic = false
      filter.cursor = 'pointer'
      transform.x = getRandomNumber(-300, 300)
      transform.y = getRandomNumber(300, 500)

      // 클릭한 객체를 삭제합니다
      object.on('click', e => {
        scene.component.children.lists.delete(e.target)
      })

      // ground 객체와 충돌한 객체의 투명도를 낮춥니다.
      object.on('collisionStart', e => {
        if (e.detail.another === ground) object.component.filter.opacity = 0.1
      })

      scene.component.children.lists.add(object)

    }

    ground.component.add(factory.create(WeJS.RESERVATION.RECT))
    ground.component.add(factory.create(WeJS.RESERVATION.PHYSICS))

    ground.component.rect.width = 1600
    ground.component.rect.height = 30
    ground.component.rect.color = 'grey'

    ground.component.physics.isStatic = true
    ground.component.transform.y = -250

    // 씬에 객체를 추가합니다.
    scene.component.children.lists.add(ground)

    // 충돌기를 설정합니다
    //scene.physicsWorld.colliders.add( collider.setBetween(objectA, objectB).createListener() )

    // 앱이 부착될 element를 지정
    app.element = '#app'
    app.setSize(800, 500)

    // 앱에서 씬을 실행0
    app.launch(scene)
  </script>
</body>

</html>